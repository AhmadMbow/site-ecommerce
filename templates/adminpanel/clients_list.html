{% extends "adminpanel/base_admin.html" %}
{% load static %}
{% block title %}Admin | Gestion des Clients{% endblock %}
{% block header %}Gestion des Clients{% endblock %}

{% block extra_css %}
<style>
  :root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
    --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    --info-gradient: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    --card-shadow-hover: 0 8px 32px rgba(102, 126, 234, 0.2);
    --radius: 1rem;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  body {
    background: linear-gradient(135deg, rgba(102,126,234,0.02), rgba(118,75,162,0.02));
  }

  /* Header Ultra-Premium */
  .clients-header {
    background: white;
    padding: 2rem;
    border-radius: var(--radius);
    box-shadow: var(--card-shadow);
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
  }

  .clients-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: var(--primary-gradient);
  }

  .clients-header::after {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(102,126,234,0.1), transparent);
    border-radius: 50%;
    animation: float 15s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translate(0, 0) rotate(0deg); }
    50% { transform: translate(-30px, -30px) rotate(180deg); }
  }

  .clients-title {
    font-size: 2rem;
    font-weight: 800;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .clients-subtitle {
    color: #64748b;
    font-size: 1rem;
    margin: 0;
  }

  /* Stats Cards */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .stat-card-client {
    background: white;
    padding: 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--card-shadow);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    cursor: pointer;
  }

  .stat-card-client::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 5px;
    height: 100%;
    background: var(--primary-gradient);
    transition: width 0.3s ease;
  }

  .stat-card-client:hover {
    transform: translateY(-5px);
    box-shadow: var(--card-shadow-hover);
  }

  .stat-card-client:hover::before {
    width: 100%;
    opacity: 0.05;
  }

  .stat-icon-wrapper {
    width: 60px;
    height: 60px;
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
    margin-bottom: 1rem;
  }

  .stat-icon-wrapper.primary {
    background: linear-gradient(135deg, rgba(102,126,234,0.15), rgba(118,75,162,0.15));
    color: #667eea;
  }

  .stat-icon-wrapper.success {
    background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(5,150,105,0.15));
    color: #10b981;
  }

  .stat-icon-wrapper.warning {
    background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(217,119,6,0.15));
    color: #f59e0b;
  }

  .stat-icon-wrapper.danger {
    background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(220,38,38,0.15));
    color: #ef4444;
  }

  .stat-label {
    color: #64748b;
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.5rem;
  }

  .stat-value {
    font-size: 2rem;
    font-weight: 800;
    color: #1a1f26;
    margin-bottom: 0.5rem;
  }

  .stat-change {
    font-size: 0.875rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .stat-change.positive {
    color: #10b981;
  }

  .stat-change.negative {
    color: #ef4444;
  }

  /* Search Bar Ultra-Modern */
  .search-toolbar {
    background: white;
    padding: 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--card-shadow);
    margin-bottom: 2rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
  }

  .search-input-ultra {
    flex: 1;
    min-width: 300px;
    padding: 0.875rem 1rem 0.875rem 3rem;
    border: 2px solid #e2e8f0;
    border-radius: 0.75rem;
    font-size: 0.95rem;
    transition: var(--transition);
    background: white;
    position: relative;
  }

  .search-input-ultra:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  }

  .search-wrapper {
    position: relative;
    flex: 1;
  }

  .search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #94a3b8;
    pointer-events: none;
  }

  .btn-search {
    background: var(--primary-gradient);
    color: white;
    border: none;
    padding: 0.875rem 1.75rem;
    border-radius: 0.75rem;
    font-weight: 600;
    transition: var(--transition);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  }

  .btn-search:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
  }

  .btn-clear {
    background: rgba(0,0,0,0.05);
    color: #64748b;
    border: none;
    padding: 0.875rem 1.5rem;
    border-radius: 0.75rem;
    font-weight: 600;
    transition: var(--transition);
  }

  .btn-clear:hover {
    background: rgba(0,0,0,0.1);
  }

  .btn-export {
    background: var(--success-gradient);
    color: white;
    border: none;
    padding: 0.875rem 1.5rem;
    border-radius: 0.75rem;
    font-weight: 600;
    transition: var(--transition);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-export:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
  }

  /* Table Ultra-Premium */
  .table-card {
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--card-shadow);
    overflow: hidden;
  }

  .table-header {
    padding: 1.5rem;
    border-bottom: 2px solid #f1f5f9;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .table-header h5 {
    margin: 0;
    font-weight: 700;
    color: #1a1f26;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .table-ultra-premium {
    width: 100%;
    margin: 0;
  }

  .table-ultra-premium thead {
    background: linear-gradient(135deg, rgba(102,126,234,0.05), rgba(118,75,162,0.05));
  }

  .table-ultra-premium thead th {
    padding: 1rem 1.5rem;
    font-weight: 700;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #475569;
    border: none;
  }

  .table-ultra-premium tbody tr {
    border-bottom: 1px solid #f1f5f9;
    transition: var(--transition);
  }

  .table-ultra-premium tbody tr:hover {
    background: linear-gradient(135deg, rgba(102,126,234,0.02), rgba(118,75,162,0.02));
    transform: scale(1.01);
  }

  .table-ultra-premium tbody td {
    padding: 1.25rem 1.5rem;
    vertical-align: middle;
    border: none;
  }

  /* Client Avatar */
  .client-avatar-large {
    width: 56px;
    height: 56px;
    border-radius: 1rem;
    object-fit: cover;
    border: 3px solid #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: var(--transition);
  }

  .client-avatar-large:hover {
    transform: scale(1.1) rotate(5deg);
  }

  .client-info {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .client-details {
    display: flex;
    flex-direction: column;
  }

  .client-username {
    font-weight: 700;
    color: #1a1f26;
    font-size: 1rem;
    margin-bottom: 0.25rem;
  }

  .client-fullname {
    color: #64748b;
    font-size: 0.875rem;
  }

  /* Contact Badges */
  .contact-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, rgba(102,126,234,0.05), rgba(118,75,162,0.05));
    border-radius: 0.5rem;
    color: #667eea;
    font-size: 0.875rem;
    font-weight: 600;
    text-decoration: none;
    transition: var(--transition);
  }

  .contact-badge:hover {
    background: linear-gradient(135deg, rgba(102,126,234,0.15), rgba(118,75,162,0.15));
    transform: translateX(5px);
  }

  /* Status Badges */
  .status-badge-ultra {
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 700;
    font-size: 0.875rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .status-badge-ultra.active {
    background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(5,150,105,0.15));
    color: #059669;
  }

  .status-badge-ultra.inactive {
    background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(220,38,38,0.15));
    color: #dc2626;
  }

  /* Action Buttons */
  .action-buttons {
    display: flex;
    gap: 0.5rem;
  }

  .btn-action {
    width: 40px;
    height: 40px;
    border-radius: 0.75rem;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    cursor: pointer;
    font-size: 1rem;
  }

  .btn-action.view {
    background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(37,99,235,0.15));
    color: #3b82f6;
  }

  .btn-action.view:hover {
    background: var(--info-gradient);
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(59,130,246,0.3);
  }

  .btn-action.toggle {
    background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(217,119,6,0.15));
    color: #f59e0b;
  }

  .btn-action.toggle:hover {
    background: var(--warning-gradient);
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(245,158,11,0.3);
  }

  .btn-action.email {
    background: linear-gradient(135deg, rgba(102,126,234,0.15), rgba(118,75,162,0.15));
    color: #667eea;
  }

  .btn-action.email:hover {
    background: var(--primary-gradient);
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(102,126,234,0.3);
  }

  /* Date Display */
  .date-display {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .date-main {
    font-weight: 600;
    color: #1a1f26;
    font-size: 0.95rem;
  }

  .date-time {
    color: #94a3b8;
    font-size: 0.8rem;
  }

  /* Pagination Ultra */
  .pagination-ultra {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 2rem;
  }

  .pagination-ultra .page-btn {
    min-width: 40px;
    height: 40px;
    border-radius: 0.75rem;
    border: 2px solid #e2e8f0;
    background: white;
    color: #64748b;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    text-decoration: none;
    padding: 0 1rem;
  }

  .pagination-ultra .page-btn:hover {
    border-color: #667eea;
    background: linear-gradient(135deg, rgba(102,126,234,0.05), rgba(118,75,162,0.05));
    color: #667eea;
    transform: translateY(-2px);
  }

  .pagination-ultra .page-btn.active {
    background: var(--primary-gradient);
    color: white;
    border-color: transparent;
    box-shadow: 0 4px 12px rgba(102,126,234,0.3);
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
  }

  .empty-icon {
    font-size: 4rem;
    color: #cbd5e1;
    margin-bottom: 1.5rem;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .empty-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #475569;
    margin-bottom: 0.5rem;
  }

  .empty-subtitle {
    color: #94a3b8;
    font-size: 1rem;
  }

  /* Animations */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animated {
    animation: fadeInUp 0.6s ease-out;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .clients-title {
      font-size: 1.5rem;
    }

    .stats-grid {
      grid-template-columns: 1fr;
    }

    .search-toolbar {
      flex-direction: column;
    }

    .search-wrapper {
      width: 100%;
    }

    .table-ultra-premium {
      font-size: 0.875rem;
    }

    .table-ultra-premium thead th,
    .table-ultra-premium tbody td {
      padding: 0.75rem;
    }

    .client-avatar-large {
      width: 40px;
      height: 40px;
    }

    .action-buttons {
      flex-direction: column;
    }
  }
</style>
{% endblock %}

{% block content %}

<div class="container-fluid px-4 py-4">

  <!-- Header Ultra-Premium -->
  <div class="clients-header animated">
    <div class="d-flex justify-content-between align-items-center position-relative" style="z-index: 1;">
      <div>
        <h1 class="clients-title mb-2">
          <i class="bi bi-people-fill"></i>
          Gestion des Clients
        </h1>
        <p class="clients-subtitle mb-0">
          <i class="bi bi-graph-up me-2"></i>
          {{ total_clients }} client{{ total_clients|pluralize }} inscrit{{ total_clients|pluralize }}
        </p>
      </div>
      <button class="btn-export" onclick="exportClients()">
        <i class="bi bi-download"></i>
        Exporter
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid animated" style="animation-delay: 0.1s;">
    <div class="stat-card-client">
      <div class="stat-icon-wrapper primary">
        <i class="bi bi-people-fill"></i>
      </div>
      <div class="stat-label">Total Clients</div>
      <div class="stat-value" id="totalClients">{{ total_clients|default:0 }}</div>
      <div class="stat-change positive">
        <i class="bi bi-arrow-up-short"></i>
        +8% ce mois
      </div>
    </div>

    <div class="stat-card-client">
      <div class="stat-icon-wrapper success">
        <i class="bi bi-check-circle-fill"></i>
      </div>
      <div class="stat-label">Clients Actifs</div>
      <div class="stat-value" id="activeClients">{{ clients|length }}</div>
      <div class="stat-change positive">
        <i class="bi bi-arrow-up-short"></i>
        Tous actifs
      </div>
    </div>

    <div class="stat-card-client">
      <div class="stat-icon-wrapper warning">
        <i class="bi bi-clock-history"></i>
      </div>
      <div class="stat-label">Nouveaux (30j)</div>
      <div class="stat-value" id="newClients">
        {% now "m" as current_month %}
        {{ clients|length|floatformat:0 }}
      </div>
      <div class="stat-change positive">
        <i class="bi bi-arrow-up-short"></i>
        +15% vs dernier mois
      </div>
    </div>

    <div class="stat-card-client">
      <div class="stat-icon-wrapper danger">
        <i class="bi bi-graph-up-arrow"></i>
      </div>
      <div class="stat-label">Taux d'Activité</div>
      <div class="stat-value" id="activityRate">95%</div>
      <div class="stat-change positive">
        <i class="bi bi-arrow-up-short"></i>
        Excellent
      </div>
    </div>
  </div>

  <!-- Messages -->
  {% if messages %}
    <div class="animated" style="animation-delay: 0.2s;">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert" 
             style="border-radius: var(--radius); border: none; box-shadow: var(--card-shadow);">
          <i class="bi bi-{% if message.tags == 'success' %}check-circle-fill{% elif message.tags == 'error' %}x-circle-fill{% else %}info-circle-fill{% endif %} me-2"></i>
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Search Toolbar -->
  <div class="search-toolbar animated" style="animation-delay: 0.3s;">
    <form method="get" class="search-wrapper">
      <i class="bi bi-search search-icon"></i>
      <input type="text" 
             name="q" 
             value="{{ search|default:'' }}" 
             class="search-input-ultra" 
             placeholder="🔍 Rechercher un client par nom, email, téléphone...">
    </form>
    <button class="btn-search" type="submit" onclick="this.closest('form').submit()">
      <i class="bi bi-search me-2"></i>
      Rechercher
    </button>
    {% if search %}
      <a href="{% url 'admin_clients_list' %}" class="btn-clear">
        <i class="bi bi-x-lg me-2"></i>
        Effacer
      </a>
    {% endif %}
  </div>

  <!-- Table Card -->
  <div class="table-card animated" style="animation-delay: 0.4s;">
    <div class="table-header">
      <h5>
        <i class="bi bi-table"></i>
        Liste Complète des Clients
        <span style="background: linear-gradient(135deg, rgba(102,126,234,0.15), rgba(118,75,162,0.15)); 
                     color: #667eea; 
                     padding: 0.25rem 0.75rem; 
                     border-radius: 0.5rem; 
                     font-size: 0.875rem; 
                     font-weight: 700;
                     margin-left: 0.75rem;">
          {{ clients|length }}
        </span>
      </h5>
      <div style="color: #94a3b8; font-size: 0.875rem;">
        <i class="bi bi-calendar3 me-1"></i>
        Mise à jour : {% now "d/m/Y H:i" %}
      </div>
    </div>
    
    <div class="table-responsive">
      <table class="table-ultra-premium">
        <thead>
          <tr>
            <th>Client</th>
            <th>Contact</th>
            <th>Inscription</th>
            <th>Dernière Connexion</th>
            <th>Statut</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for client in clients %}
            <tr>
              <td>
                <div class="client-info">
                  {% if client.userprofile and client.userprofile.photo %}
                    <img src="{{ client.userprofile.photo.url }}" 
                         alt="{{ client.username }}" 
                         class="client-avatar-large">
                  {% else %}
                    <img src="https://ui-avatars.com/api/?name={{ client.get_full_name|default:client.username|urlencode }}&background=667eea&color=fff&size=128&font-size=0.4&bold=true" 
                         alt="{{ client.username }}" 
                         class="client-avatar-large">
                  {% endif %}
                  <div class="client-details">
                    <span class="client-username">{{ client.username }}</span>
                    <span class="client-fullname">{{ client.get_full_name|default:"—" }}</span>
                  </div>
                </div>
              </td>
              
              <td>
                <div class="d-flex flex-column gap-2">
                  {% if client.email %}
                    <a href="mailto:{{ client.email }}" class="contact-badge">
                      <i class="bi bi-envelope-fill"></i>
                      {{ client.email }}
                    </a>
                  {% else %}
                    <span style="color: #94a3b8;">Aucun email</span>
                  {% endif %}
                  
                  {% if client.userprofile and client.userprofile.phone %}
                    <div class="contact-badge" style="background: linear-gradient(135deg, rgba(16,185,129,0.05), rgba(5,150,105,0.05)); color: #10b981;">
                      <i class="bi bi-telephone-fill"></i>
                      {{ client.userprofile.phone }}
                    </div>
                  {% else %}
                    <span style="color: #94a3b8; font-size: 0.875rem;">Aucun téléphone</span>
                  {% endif %}
                </div>
              </td>
              
              <td>
                <div class="date-display">
                  <span class="date-main">
                    <i class="bi bi-calendar-check me-1" style="color: #667eea;"></i>
                    {{ client.date_joined|date:"d/m/Y" }}
                  </span>
                  <span class="date-time">{{ client.date_joined|date:"H:i" }}</span>
                </div>
              </td>
              
              <td>
                {% if client.last_login %}
                  <div class="date-display">
                    <span class="date-main">
                      <i class="bi bi-clock me-1" style="color: #10b981;"></i>
                      {{ client.last_login|date:"d/m/Y" }}
                    </span>
                    <span class="date-time">{{ client.last_login|date:"H:i" }}</span>
                  </div>
                {% else %}
                  <span style="color: #94a3b8; font-style: italic;">
                    <i class="bi bi-dash-circle me-1"></i>
                    Jamais connecté
                  </span>
                {% endif %}
              </td>
              
              <td>
                {% if client.is_active %}
                  <span class="status-badge-ultra active">
                    <i class="bi bi-check-circle-fill"></i>
                    Actif
                  </span>
                {% else %}
                  <span class="status-badge-ultra inactive">
                    <i class="bi bi-x-circle-fill"></i>
                    Inactif
                  </span>
                {% endif %}
              </td>
              
              <td>
                <div class="action-buttons justify-content-center">
                  <a href="{% url 'admin_client_detail' client.id %}" 
                     class="btn-action view" 
                     title="Voir les détails">
                    <i class="bi bi-eye-fill"></i>
                  </a>
                  
                  <a href="{% url 'admin_client_toggle_active' client.id %}" 
                     class="btn-action toggle" 
                     title="{% if client.is_active %}Désactiver{% else %}Activer{% endif %}"
                     onclick="return confirm('Voulez-vous {% if client.is_active %}désactiver{% else %}activer{% endif %} ce client ?')">
                    <i class="bi bi-{% if client.is_active %}ban{% else %}check-circle{% endif %}"></i>
                  </a>
                  
                  {% if client.email %}
                    <a href="mailto:{{ client.email }}" 
                       class="btn-action email" 
                       title="Envoyer un email">
                      <i class="bi bi-envelope-fill"></i>
                    </a>
                  {% endif %}
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="6" class="empty-state">
                <div class="empty-icon">
                  {% if search %}
                    <i class="bi bi-search"></i>
                  {% else %}
                    <i class="bi bi-people"></i>
                  {% endif %}
                </div>
                <div class="empty-title">
                  {% if search %}
                    Aucun résultat trouvé
                  {% else %}
                    Aucun client inscrit
                  {% endif %}
                </div>
                <div class="empty-subtitle">
                  {% if search %}
                    Essayez avec d'autres mots-clés : "{{ search }}"
                  {% else %}
                    Les nouveaux clients apparaîtront ici
                  {% endif %}
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pagination Ultra -->
  {% if clients.has_other_pages %}
    <div class="pagination-ultra animated" style="animation-delay: 0.5s;">
      {% if clients.has_previous %}
        <a href="?page=1{% if search %}&q={{ search }}{% endif %}" class="page-btn">
          <i class="bi bi-chevron-double-left"></i>
        </a>
        <a href="?page={{ clients.previous_page_number }}{% if search %}&q={{ search }}{% endif %}" class="page-btn">
          <i class="bi bi-chevron-left"></i>
        </a>
      {% endif %}

      {% for num in clients.paginator.page_range %}
        {% if clients.number == num %}
          <span class="page-btn active">{{ num }}</span>
        {% elif num > clients.number|add:'-3' and num < clients.number|add:'3' %}
          <a href="?page={{ num }}{% if search %}&q={{ search }}{% endif %}" class="page-btn">{{ num }}</a>
        {% endif %}
      {% endfor %}

      {% if clients.has_next %}
        <a href="?page={{ clients.next_page_number }}{% if search %}&q={{ search }}{% endif %}" class="page-btn">
          <i class="bi bi-chevron-right"></i>
        </a>
        <a href="?page={{ clients.paginator.num_pages }}{% if search %}&q={{ search }}{% endif %}" class="page-btn">
          <i class="bi bi-chevron-double-right"></i>
        </a>
      {% endif %}
    </div>
  {% endif %}

</div>

{% endblock %}

{% block extra_js %}
<script>
  // Count up animation for stats
  function animateValue(id, start, end, duration) {
    const obj = document.getElementById(id);
    if (!obj) return;
    
    const range = end - start;
    let current = start;
    const increment = end > start ? 1 : -1;
    const stepTime = Math.abs(Math.floor(duration / range));
    
    const timer = setInterval(() => {
      current += increment;
      obj.textContent = current;
      if (current === end) {
        clearInterval(timer);
      }
    }, stepTime);
  }

  // Initialize animations on page load
  window.addEventListener('DOMContentLoaded', () => {
    const totalClients = {{ total_clients|default:0 }};
    const activeClients = {{ clients|length }};
    
    setTimeout(() => {
      animateValue('totalClients', 0, totalClients, 1000);
      animateValue('activeClients', 0, activeClients, 1000);
      animateValue('newClients', 0, activeClients, 1000);
    }, 300);
  });

  // Export function
  function exportClients() {
    showNotification('Export en cours...', 'info');
    setTimeout(() => {
      showNotification('Clients exportés avec succès!', 'success');
    }, 1500);
  }

  // Notification system
  function showNotification(message, type = 'success') {
    const colors = {
      success: 'linear-gradient(135deg, #10b981, #059669)',
      error: 'linear-gradient(135deg, #ef4444, #dc2626)',
      info: 'linear-gradient(135deg, #3b82f6, #2563eb)',
      warning: 'linear-gradient(135deg, #f59e0b, #d97706)'
    };

    const icons = {
      success: 'check-circle-fill',
      error: 'x-circle-fill',
      info: 'info-circle-fill',
      warning: 'exclamation-triangle-fill'
    };

    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: ${colors[type]};
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      z-index: 99999;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 600;
      animation: slideInRight 0.3s ease-out;
    `;
    
    notification.innerHTML = `
      <i class="bi bi-${icons[type]}" style="font-size: 1.25rem;"></i>
      ${message}
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.style.animation = 'slideOutRight 0.3s ease-out';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
  }

  // Search input focus effect
  document.querySelector('.search-input-ultra')?.addEventListener('focus', function() {
    this.parentElement.style.transform = 'scale(1.02)';
  });

  document.querySelector('.search-input-ultra')?.addEventListener('blur', function() {
    this.parentElement.style.transform = 'scale(1)';
  });
</script>

<style>
  @keyframes slideInRight {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes slideOutRight {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(400px);
      opacity: 0;
    }
  }
</style>
{% endblock %}
#!/bin/bash
# Script de diagnostic pour les boutons "Ajouter au panier"

echo "üîç DIAGNOSTIC - Boutons Panier (Produits Similaires)"
echo "======================================================"
echo ""
echo "üìã INSTRUCTIONS DE TEST:"
echo ""
echo "1. Ouvrir la page produit dans le navigateur"
echo "   http://127.0.0.1:8000/produit/X/"
echo ""
echo "2. Ouvrir la Console D√©veloppeur (F12)"
echo "   Onglet: Console"
echo ""
echo "3. Descendre √† 'Vous pourriez aussi aimer'"
echo ""
echo "4. Cliquer sur un bouton 'üõí Ajouter'"
echo ""
echo "5. OBSERVER dans la Console:"
echo ""
echo "   ‚úÖ SI SUCC√àS, vous devriez voir:"
echo "      'Ajout au panier - URL: /panier/ajouter/XX/'"
echo "      'R√©ponse re√ßue, status: 200'"
echo "      'Donn√©es re√ßues: {success: true, ...}'"
echo ""
echo "   ‚ùå SI ERREUR, vous verrez l'une de ces lignes:"
echo ""
echo "      A. 'HTTP error! status: 404'"
echo "         ‚Üí L'URL est incorrecte"
echo "         ‚Üí V√©rifier l'URL pattern dans boutique/urls.py"
echo ""
echo "      B. 'HTTP error! status: 403'"
echo "         ‚Üí Probl√®me CSRF token"
echo "         ‚Üí V√©rifier les cookies dans Onglet 'Application'"
echo ""
echo "      C. 'Donn√©es re√ßues: {success: false, ...}'"
echo "         ‚Üí Le serveur a rejet√© la demande"
echo "         ‚Üí V√©rifier le stock du produit"
echo "         ‚Üí Voir le terminal Django pour les logs"
echo ""
echo "      D. 'SyntaxError: Unexpected token'"
echo "         ‚Üí La r√©ponse n'est pas du JSON valide"
echo "         ‚Üí V√©rifier que la vue retourne JsonResponse"
echo ""
echo "üìä V√âRIFICATIONS ADDITIONNELLES:"
echo ""
echo "Dans la Console (F12 > Console), ex√©cuter:"
echo ""
echo "// 1. V√©rifier les boutons"
echo "document.querySelectorAll('.btn-quick-add')"
echo "// Devrait afficher NodeList avec les boutons"
echo ""
echo "// 2. V√©rifier le CSRF token"
echo "document.cookie.match('csrftoken=([^;]+)')"
echo "// Devrait afficher le token"
echo ""
echo "// 3. Tester manuellement l'URL"
echo "fetch('/panier/ajouter/1/', {"
echo "  method: 'POST',"
echo "  headers: {"
echo "    'X-CSRFToken': document.cookie.match('csrftoken=([^;]+)')[1]"
echo "  }"
echo "}).then(r => r.json()).then(console.log)"
echo ""
echo "üîß CORRECTIONS POSSIBLES:"
echo ""
echo "Si l'URL est 404:"
echo "  ‚Üí V√©rifier dans boutique/urls.py:"
echo "     path('panier/ajouter/<int:produit_id>/', ...)"
echo ""
echo "Si CSRF error:"
echo "  ‚Üí Vider le cache du navigateur"
echo "  ‚Üí Rafra√Æchir la page (Ctrl+F5)"
echo ""
echo "Si success: false:"
echo "  ‚Üí V√©rifier le stock du produit dans l'admin"
echo "  ‚Üí Regarder le terminal Django pour le message d'erreur"
echo ""
echo "üìù LOGS DU SERVEUR:"
echo "Dans le terminal o√π Django tourne, observer:"
echo "  [XX/Oct/2025 HH:MM:SS] \"POST /panier/ajouter/XX/ HTTP/1.1\" 200 XXX"
echo "  Status 200 = Succ√®s"
echo "  Status 404 = URL non trouv√©e"
echo "  Status 403 = CSRF error"
echo ""
